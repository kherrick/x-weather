{"version":3,"file":"x-forecast.js","sources":["../../src/components/x-forecast.js"],"sourcesContent":["import { convertTemperature, dateTime, isObjectEmpty, loadComponent, unixEpochToDate } from '../utilities.js'\n// import forecast from '../../fixtures/forecast'\n\nconst template = `\n  <style>\n    :host {\n      display: block;\n\n      --x-forecast-item-float: inherit;\n      --x-forecast-item-width: inherit;\n    }\n\n    x-forecast-item {\n      float: var(--x-forecast-item-float);\n      width: var(--x-forecast-item-width);\n    }\n  </style>\n\n  <div data-x-forecast>\n    <div data-x-forecast-date-container>\n  <div/>\n`\n\nconst XForecast = class extends HTMLElement {\n  constructor() {\n    super()\n\n    const container = document.createElement('div')\n    container.innerHTML = template\n\n    this.attachShadow({ mode: 'open' }).appendChild(container)\n  }\n\n  connectedCallback() {\n    this.refresh().then((currentForecast) => {\n      this.render(currentForecast, this.days)\n\n      // set this as a class property to be used later\n      this.currentForecast = currentForecast\n    })\n  }\n\n  attributeChangedCallback(attrName, oldVal, newVal) {\n    // handle the scale and days attribute change\n    if (oldVal === newVal) {\n      return\n    }\n\n    if (this.days === null) {\n      return\n    }\n\n    if (attrName === 'days' || attrName === 'scale') {\n      this.render(this.currentForecast, this.days)\n    }\n  }\n\n  static get observedAttributes() {\n    return [ 'days', 'scale' ]\n  }\n\n  get appid() {\n    return this.getAttribute('appid')\n  }\n\n  set appid(appid) {\n    this.setAttribute('appid', appid)\n  }\n\n  get days() {\n    return this.getAttribute('days')\n  }\n\n  set days(days) {\n    this.setAttribute('days', days)\n  }\n\n  get host() {\n    return this.getAttribute('host')\n  }\n\n  set host(host) {\n    this.setAttribute('host', host)\n  }\n\n  get location() {\n    return this.getAttribute('location')\n  }\n\n  set location(location) {\n    this.setAttribute('location', location)\n  }\n\n  get scale() {\n    return this.getAttribute('scale')\n  }\n\n  set scale(scale) {\n    this.setAttribute('scale', scale)\n  }\n\n  _buildDateContainer(forecast, days) {\n    const dateContainer = document.createElement('div')\n    dateContainer.setAttribute('data-x-forecast-date-container', '')\n\n    // build forecast list\n    if (forecast && !isObjectEmpty(forecast)) {\n      const today = dateTime(new Date()).Y('-').m('-').d('').getResults()\n\n      // shorten the forecast to the requested number of days, https://mzl.la/2JDIuy6\n      // if the attribute is changed to be smaller\n      if (forecast.length > days) {\n        forecast.length = days;\n      }\n\n      forecast.forEach(props => {\n        const { dt, temp, pressure, humidity, weather, speed, deg, clouds, rain } = props // eslint-disable-line no-unused-vars\n\n        const dateItem = document.createElement('x-forecast-item')\n        dateItem.setAttribute('day', this._convertForecast({ scale: this.scale, timeOfDayTemp: temp.day }))\n        dateItem.setAttribute('description', weather[0].description)\n        dateItem.setAttribute('forecast-date', this._getDayOfWeek({ dt, today }))\n        dateItem.setAttribute('icon', `https://openweathermap.org/img/w/${weather[0].icon}.png`)\n        dateItem.setAttribute('night', this._convertForecast({ scale: this.scale, timeOfDayTemp: temp.night }))\n        dateItem.setAttribute('scale', this.scale)\n\n        dateContainer.appendChild(dateItem)\n      })\n    }\n\n    return dateContainer\n  }\n\n  _convertForecast({ scale, timeOfDayTemp }) {\n    return `${Number.parseFloat(scale === 'F' ? convertTemperature(timeOfDayTemp, 'cToF') : timeOfDayTemp).toFixed(2)}`\n  }\n\n  _getDayOfWeek({ dt, today }) {\n    const timestamp = unixEpochToDate(dt)\n    const current = dateTime(timestamp).Y('-').m('-').d().getResults()\n\n    if (current === today) {\n      return 'Today:'\n    }\n\n    const weekDay = dateTime(timestamp)['date'].toLocaleString('en-US', { weekday: 'long'} )\n    const ddMM = dateTime(timestamp).m('/').d().getResults()\n\n    return `${weekDay} (${ddMM}):`\n  }\n\n  _getForecast({ appid, host, location }) {\n    if (appid && host && location) {\n      return this._serviceHandler({ appid, host, location }).then(result => {\n        const { city, cod, message, cnt, list } = result // eslint-disable-line no-unused-vars\n\n        return list\n      })\n    }\n  }\n\n  _serviceHandler({ appid, host, location }) {\n    const url = `https://${host}/data/2.5/forecast/daily?q=${location}&mode=json&units=metric&cnt=14&appid=${appid}` // eslint-disable-line no-unused-vars\n\n    // return forecast\n    return fetch(url, {\n      method: 'GET'\n    }).then(res => {\n      if (res.ok) {\n        return res.json()\n      }\n    })\n  }\n\n  refresh() {\n    const config = {\n      appid: this.parentElement.getAttribute('appid'),\n      host: this.parentElement.getAttribute('host'),\n      location: this.parentElement.getAttribute('location')\n    }\n\n    return this._getForecast(config)\n  }\n\n  render(res, days) {\n    const forecastDayNode = this.shadowRoot.querySelector('[data-x-forecast]')\n    const dateContainerNode = this.shadowRoot.querySelector('[data-x-forecast] > [data-x-forecast-date-container]')\n\n    forecastDayNode.replaceChild(this._buildDateContainer(res, days), dateContainerNode)\n  }\n}\n\nexport const load = () => loadComponent({\n  customElements: customElements,\n  tagName: 'x-forecast',\n  element: XForecast\n})\n\nexport default XForecast\n"],"names":["template","XForecast","container","document","createElement","innerHTML","attachShadow","mode","appendChild","refresh","then","currentForecast","render","days","attrName","oldVal","newVal","forecast","dateContainer","setAttribute","isObjectEmpty","today","dateTime","Date","Y","m","d","getResults","length","forEach","dt","props","temp","pressure","humidity","weather","speed","deg","clouds","rain","dateItem","_convertForecast","scale","timeOfDayTemp","day","description","_getDayOfWeek","icon","night","Number","parseFloat","convertTemperature","toFixed","timestamp","unixEpochToDate","current","weekDay","toLocaleString","weekday","ddMM","appid","host","location","_serviceHandler","city","result","cod","message","cnt","list","url","fetch","res","ok","json","config","parentElement","getAttribute","_getForecast","forecastDayNode","shadowRoot","querySelector","dateContainerNode","replaceChild","_buildDateContainer","load","loadComponent","customElements"],"mappings":"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"}