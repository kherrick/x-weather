{"version":3,"file":"x-forecast.js","sources":["../../src/components/x-forecast.js"],"sourcesContent":["import { convertTemperature, dateTime, isObjectEmpty, loadComponent, unixEpochToDate } from '../utilities.js'\n// import forecast from '../../fixtures/forecast'\n\nconst template = `\n  <style>\n    :host {\n      display: block;\n\n      --x-forecast-item-float: inherit;\n      --x-forecast-item-width: inherit;\n    }\n\n    x-forecast-item {\n      float: var(--x-forecast-item-float);\n      width: var(--x-forecast-item-width);\n    }\n  </style>\n\n  <div data-x-forecast>\n    <div data-x-forecast-date-container>\n  <div/>\n`\n\nconst XForecast = class extends HTMLElement {\n  constructor() {\n    super()\n\n    const container = document.createElement('div')\n    container.innerHTML = template\n\n    this.attachShadow({ mode: 'open' }).appendChild(container)\n  }\n\n  connectedCallback() {\n    this.refresh().then((currentForecast) => {\n      this.render(currentForecast, this.days)\n\n      // set this as a class property to be used later\n      this.currentForecast = currentForecast\n    })\n  }\n\n  attributeChangedCallback(attrName, oldVal, newVal) {\n    // handle the scale and days attribute change\n    if (oldVal === newVal) {\n      return\n    }\n\n    if (this.days === null) {\n      return\n    }\n\n    if (attrName === 'days' || attrName === 'scale') {\n      this.render(this.currentForecast, this.days)\n    }\n  }\n\n  static get observedAttributes() {\n    return [ 'days', 'scale' ]\n  }\n\n  get appid() {\n    return this.getAttribute('appid')\n  }\n\n  set appid(appid) {\n    this.setAttribute('appid', appid)\n  }\n\n  get days() {\n    return this.getAttribute('days')\n  }\n\n  set days(days) {\n    this.setAttribute('days', days)\n  }\n\n  get host() {\n    return this.getAttribute('host')\n  }\n\n  set host(host) {\n    this.setAttribute('host', host)\n  }\n\n  get location() {\n    return this.getAttribute('location')\n  }\n\n  set location(location) {\n    this.setAttribute('location', location)\n  }\n\n  get scale() {\n    return this.getAttribute('scale')\n  }\n\n  set scale(scale) {\n    this.setAttribute('scale', scale)\n  }\n\n  _buildDateContainer(forecast, days) {\n    const dateContainer = document.createElement('div')\n    dateContainer.setAttribute('data-x-forecast-date-container', '')\n\n    // build forecast list\n    if (forecast && !isObjectEmpty(forecast)) {\n      const today = dateTime(new Date()).Y('-').m('-').d('').getResults()\n\n      // shorten the forecast to the requested number of days, https://mzl.la/2JDIuy6\n      // if the attribute is changed to be smaller\n      if (forecast.length > days) {\n        forecast.length = days;\n      }\n\n      forecast.forEach(props => {\n        const { dt, temp, pressure, humidity, weather, speed, deg, clouds, rain } = props // eslint-disable-line no-unused-vars\n\n        const dateItem = document.createElement('x-forecast-item')\n        dateItem.setAttribute('day', this._convertForecast({ scale: this.scale, timeOfDayTemp: temp.day }))\n        dateItem.setAttribute('description', weather[0].description)\n        dateItem.setAttribute('forecast-date', this._getDayOfWeek({ dt, today }))\n        dateItem.setAttribute('icon', `https://openweathermap.org/img/w/${weather[0].icon}.png`)\n        dateItem.setAttribute('night', this._convertForecast({ scale: this.scale, timeOfDayTemp: temp.night }))\n        dateItem.setAttribute('scale', this.scale)\n\n        dateContainer.appendChild(dateItem)\n      })\n    }\n\n    return dateContainer\n  }\n\n  _convertForecast({ scale, timeOfDayTemp }) {\n    return `${Number.parseFloat(scale === 'F' ? convertTemperature(timeOfDayTemp, 'cToF') : timeOfDayTemp).toFixed(2)}`\n  }\n\n  _getDayOfWeek({ dt, today }) {\n    const timestamp = unixEpochToDate(dt)\n    const current = dateTime(timestamp).Y('-').m('-').d().getResults()\n\n    if (current === today) {\n      return 'Today:'\n    }\n\n    const weekDay = dateTime(timestamp)['date'].toLocaleString('en-US', { weekday: 'long'} )\n    const ddMM = dateTime(timestamp).m('/').d().getResults()\n\n    return `${weekDay} (${ddMM}):`\n  }\n\n  _getForecast({ appid, host, location }) {\n    if (appid && host && location) {\n      return this._serviceHandler({ appid, host, location }).then(result => {\n        const { city, cod, message, cnt, list } = result // eslint-disable-line no-unused-vars\n\n        return list\n      })\n    }\n  }\n\n  _serviceHandler({ appid, host, location }) {\n    const url = `https://${host}/data/2.5/forecast/daily?q=${location}&mode=json&units=metric&cnt=14&appid=${appid}` // eslint-disable-line no-unused-vars\n\n    // return forecast\n    return fetch(url, {\n      method: 'GET'\n    }).then(res => {\n      if (res.ok) {\n        return res.json()\n      }\n    })\n  }\n\n  refresh() {\n    const config = {\n      appid: this.parentElement.getAttribute('appid'),\n      host: this.parentElement.getAttribute('host'),\n      location: this.parentElement.getAttribute('location')\n    }\n\n    return this._getForecast(config)\n  }\n\n  render(res, days) {\n    const forecastDayNode = this.shadowRoot.querySelector('[data-x-forecast]')\n    const dateContainerNode = this.shadowRoot.querySelector('[data-x-forecast] > [data-x-forecast-date-container]')\n\n    forecastDayNode.replaceChild(this._buildDateContainer(res, days), dateContainerNode)\n  }\n}\n\nexport const load = () => loadComponent({\n  customElements: customElements,\n  tagName: 'x-forecast',\n  element: XForecast\n})\n\nexport default XForecast\n"],"names":["template","XForecast","container","document","createElement","innerHTML","attachShadow","mode","appendChild","refresh","then","currentForecast","render","days","attrName","oldVal","newVal","forecast","dateContainer","setAttribute","isObjectEmpty","today","dateTime","Date","Y","m","d","getResults","length","forEach","dt","props","temp","pressure","humidity","weather","speed","deg","clouds","rain","dateItem","_convertForecast","scale","timeOfDayTemp","day","description","_getDayOfWeek","icon","night","Number","parseFloat","convertTemperature","toFixed","timestamp","unixEpochToDate","current","weekDay","toLocaleString","weekday","ddMM","appid","host","location","_serviceHandler","city","result","cod","message","cnt","list","url","fetch","method","res","ok","json","config","parentElement","getAttribute","_getForecast","forecastDayNode","shadowRoot","querySelector","dateContainerNode","replaceChild","_buildDateContainer","load","loadComponent","customElements","tagName","element"],"mappings":"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"}